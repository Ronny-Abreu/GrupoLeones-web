<section id="contacto" class="py-20 bg-white">
  <div class="container mx-auto px-4 max-w-7xl">
    <div class="grid lg:grid-cols-2 gap-12 items-center">
      <!-- Left Side - Promotional Card -->
      <div class="bg-gradient-to-br from-red-600 to-red-800 rounded-3xl p-8 md:p-12 text-white relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-12 -translate-x-12"></div>
        
        <div class="relative z-10">
          <div class="mb-6">
            <svg class="w-16 h-16 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          
          <h3 class="text-3xl md:text-4xl font-bold mb-6">
            ¡Impulsa tus ideas con nosotros!
          </h3>
          
          <p class="text-lg md:text-xl mb-8 text-white/90 leading-relaxed">
            Únete a nuestro plan estratégico y transforma tu visión en realidad. 
            Con Grupo Leones, cada idea tiene el potencial de convertirse en un éxito extraordinario.
          </p>
          
          <div class="space-y-4 mb-8">
            <div class="flex items-center gap-3">
              <svg class="w-6 h-6 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="text-white/90">Asesoría personalizada 24/7</span>
            </div>
            <div class="flex items-center gap-3">
              <svg class="w-6 h-6 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="text-white/90">Acceso a todas nuestras filiales</span>
            </div>
            <div class="flex items-center gap-3">
              <svg class="w-6 h-6 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span class="text-white/90">Estrategias probadas de crecimiento</span>
            </div>
          </div>
          
          <p class="text-white/80 text-lg font-medium">
            ¿Listo para dar el siguiente paso? 
            <br class="hidden md:block">
            <span class="text-white font-bold">¡Contáctanos ahora!</span>
          </p>
        </div>
      </div>

      <!-- Right Side - Contact Form -->
      <div class="bg-gray-50 rounded-3xl p-8 md:p-12">
        <div class="text-center mb-8">
          <h3 class="text-3xl font-bold text-gray-900 mb-4">Envíanos tu consulta</h3>
          <p class="text-gray-600">Completa el formulario y nos pondremos en contacto contigo en menos de 24 horas</p>
        </div>

        <form id="contactForm" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">Nombre completo</label>
              <input 
                type="text" 
                id="nombre" 
                name="nombre" 
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-300 text-black"
                placeholder="Tu nombre"
              />
            </div>
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Correo electrónico</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-300 text-black"
                placeholder="tu@email.com"
              />
            </div>
          </div>

          <div>
            <label for="telefono" class="block text-sm font-medium text-gray-700 mb-2">Teléfono (opcional)</label>
            <input 
              type="tel" 
              id="telefono" 
              name="telefono"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-300 text-black"
              placeholder="+1 809 999 0000"
            />
          </div>

          <div>
            <label for="asunto" class="block text-sm font-medium text-gray-700 mb-2">Asunto</label>
            <select 
              id="asunto" 
              name="asunto" 
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-300 text-black"
            >
              <option value="">Selecciona un tema</option>
              <option value="Consulta General">Consulta General</option>
              <option value="Leones Capital">Leones Capital</option>
              <option value="Leones Seguros">Leones Seguros</option>
              <option value="Leones Finanzas">Leones Finanzas</option>
              <option value="Leones Marketing">Leones Marketing</option>
              <option value="Leones Talento">Leones Talento</option>
              <option value="Leones Impacto">Leones Impacto</option>
            </select>
          </div>

          <div>
            <label for="mensaje" class="block text-sm font-medium text-gray-700 mb-2">Mensaje</label>
            <textarea 
              id="mensaje" 
              name="mensaje" 
              rows="5" 
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-300 resize-none text-black"
              placeholder="Cuéntanos cómo podemos ayudarte..."
            ></textarea>
          </div>

          <button 
            type="submit" 
            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
          >
            <span class="flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
              </svg>
              Enviar mensaje
            </span>
          </button>
        </form>

        <!-- Success Message -->
        <div id="successMessage" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-xl">
          <div class="flex items-center gap-2 text-green-800">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span class="font-medium">¡Mensaje enviado exitosamente!</span>
          </div>
          <p class="text-green-700 text-sm mt-1">Te responderemos en un plazo máximo de 24 horas.</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-xl">
          <div class="flex items-center gap-2 text-red-800">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="font-medium">Error al enviar el mensaje</span>
          </div>
          <p class="text-red-700 text-sm mt-1" id="errorText">Por favor, inténtalo de nuevo.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contactForm') as HTMLFormElement;
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    const errorText = document.getElementById('errorText');

    if (!form || !successMessage || !errorMessage || !errorText) {
      console.error('Elementos del formulario no encontrados');
      return;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const data = Object.fromEntries(formData);
      
      // Validación del lado del cliente
      if (!data.nombre || !data.email || !data.asunto || !data.mensaje) {
        showError('Por favor, completa todos los campos obligatorios.');
        return;
      }

      // Validar email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(data.email as string)) {
        showError('Por favor, ingresa un email válido.');
        return;
      }

      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      if (!submitBtn) return;
      
      const originalContent = submitBtn.innerHTML;
      submitBtn.innerHTML = `
        <span class="flex items-center justify-center gap-2">
          <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          Enviando...
        </span>
      `;
      submitBtn.disabled = true;

      try {
        console.log('Enviando datos:', data);

        const response = await fetch('/api/send-email', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        console.log('Response status:', response.status);
        console.log('Response headers:', response.headers.get('content-type'));

        // Verificar si la respuesta es JSON
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const textResponse = await response.text();
          console.error('Respuesta no es JSON:', textResponse);
          throw new Error('El servidor no devolvió una respuesta JSON válida');
        }

        const result = await response.json();
        console.log('Resultado:', result);

        if (response.ok && result.success) {
          form.reset();
          showSuccess();
        } else {
          throw new Error(result.message || 'Error al enviar el mensaje');
        }
      } catch (error) {
        console.error('Error completo:', error);
        showError(`Hubo un error al enviar tu mensaje: ${error instanceof Error ? error.message : 'Error desconocido'}. Por favor, inténtalo de nuevo.`);
      } finally {
        submitBtn.innerHTML = originalContent;
        submitBtn.disabled = false;
      }
    });

    function showSuccess() {
      if (!successMessage || !errorMessage) return;
      successMessage.classList.remove('hidden');
      errorMessage.classList.add('hidden');
      setTimeout(() => {
        if (successMessage) {
          successMessage.classList.add('hidden');
        }
      }, 8000);
    }

    function showError(message: string) {
      if (!errorText || !errorMessage || !successMessage) return;
      errorText.textContent = message;
      errorMessage.classList.remove('hidden');
      successMessage.classList.add('hidden');
      setTimeout(() => {
        if (errorMessage) {
          errorMessage.classList.add('hidden');
        }
      }, 8000);
    }
  });
</script>
